actions:
  - name: Build
    os: "darwin"
    triggers:
      push:
        branches:
          - "main"
      pull_request:
        branches:
          - "main"
    bazel_commands:
      # `--noincompatible_disallow_empty_glob` is to work around an issue in
      # "cgrindel_bazel_starlib/bzlformat/private/bzlformat_pkg.bzl"
      - "build --config=workflows --noincompatible_disallow_empty_glob //..."

  - name: Test
    os: "darwin"
    triggers:
      push:
        branches:
          - "main"
      pull_request:
        branches:
          - "main"
    bazel_commands:
      - "test --config=workflows //tools/... //test/..."

  - name: Integration Test
    os: "darwin"
    triggers:
      push:
        branches:
          - "main"
      pull_request:
        branches:
          - "main"
    bazel_commands:
      - "clean"
      # `--noincompatible_disallow_empty_glob` is to work around an issue in
      # "cgrindel_bazel_starlib/bzlformat/private/bzlformat_pkg.bzl"
      - "test --config=workflows --noincompatible_disallow_empty_glob //:all_integration_tests"

  - name: Buildifier Lint
    triggers:
      push:
        branches:
          - "main"
      pull_request:
        branches:
          - "main"
    bazel_commands:
      - "run --config=workflows //:buildifier.check"
